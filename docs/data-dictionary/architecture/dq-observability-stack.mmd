flowchart TD

    %% ======================================================
    %%   FABRIC SALES ANALYTICS — DQ OBSERVABILITY STACK
    %% ======================================================

    subgraph Inputs["DQ Inputs"]
        I1["DQ Summary Table"]
        I2["Exception Tables<br/>dq_*_exceptions"]
        I3["Pipeline Metadata<br/>run_id, timestamps"]
    end

    subgraph Transform["Monitoring Transformations"]
        T1["Rule-Level Aggregations<br/>• Pass/Fail counts<br/>• Severity distribution"]
        T2["Table-Level Health Metrics<br/>• Exception ratios<br/>• Volume anomalies"]
        T3["Pipeline KPIs<br/>• Duration<br/>• Success/Failure<br/>• SLA checks"]
    end

    subgraph Storage["Monitoring Storage"]
        S1["DQ Metrics Table"]
        S2["DQ Trends Table"]
        S3["Pipeline Health Table"]
    end

    subgraph Dash["DQ Dashboard"]
        D1["Rule Quality View"]
        D2["Exception Heatmap"]
        D3["Pipeline Reliability View"]
        D4["Historical Trends"]
    end

    subgraph Alerts["Alerting Layer"]
        A1["High Exception Volume Alert"]
        A2["Rule Failure Spike Alert"]
        A3["Pipeline SLA Breach Alert"]
    end

    %% FLOWS
    I1 --> T1 --> S1
    I2 --> T2 --> S2
    I3 --> T3 --> S3

    S1 --> D1
    S2 --> D2
    S3 --> D3
    S2 --> D4

    S2 --> A1
    S1 --> A2
    S3 --> A3