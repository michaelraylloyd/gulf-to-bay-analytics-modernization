flowchart TD

    %% ======================================================
    %%   FABRIC SALES ANALYTICS â€” DQ OPERATIONAL RUNBOOK
    %%   Triage, Escalation, and Resolution Workflow
    %% ======================================================

    %% -------- DETECTION --------
    subgraph Detect["Detection Layer"]
        D1["Automated DQ Checks<br/>Pipeline execution"]
        D2["Exception Tables<br/>dq_*_exceptions"]
        D3["DQ Summary Table<br/>Rule-level stats"]
        D4["Alerts<br/>Volume spikes / SLA breaches"]
    end

    %% -------- TRIAGE --------
    subgraph Triage["Triage Workflow"]
        T1["Steward Review Queue<br/>New exceptions"]
        T2["Classify Issue<br/>Data error / Rule error / Upstream issue"]
        T3["Assess Severity<br/>info | warn | error"]
        T4["Assign Owner<br/>Steward / Engineer / Business"]
    end

    %% -------- RESOLUTION --------
    subgraph Resolve["Resolution Paths"]
        R1["Data Correction<br/>Fix source data"]
        R2["Rule Adjustment<br/>Threshold or logic update"]
        R3["Schema Update<br/>Column changes / new fields"]
        R4["Pipeline Fix<br/>Transformation or join logic"]
        R5["Business Decision<br/>Acceptable exception"]
    end

    %% -------- GOVERNANCE --------
    subgraph Governance["Governance & Documentation"]
        G1["Update expectations.json"]
        G2["Update Data Dictionary"]
        G3["Update DQ Policy / Playbook"]
        G4["Record Resolution Notes"]
    end

    %% -------- FEEDBACK LOOP --------
    subgraph Feedback["Continuous Improvement"]
        F1["Monitor Trends"]
        F2["Identify Recurring Issues"]
        F3["Propose Rule Enhancements"]
        F4["Refine SLAs & Alerts"]
    end

    %% FLOWS
    D1 --> T1
    D2 --> T1
    D3 --> T1
    D4 --> T1

    T1 --> T2 --> T3 --> T4

    T4 --> R1
    T4 --> R2
    T4 --> R3
    T4 --> R4
    T4 --> R5

    R1 --> G4
    R2 --> G1
    R3 --> G2
    R4 --> G4
    R5 --> G4

    G1 --> F1
    G2 --> F1
    G3 --> F1
    G4 --> F1

    F1 --> F2 --> F3 --> F4 --> G3