flowchart TD

    %% ======================================================
    %%   FABRIC SALES ANALYTICS — GOLD CONSUMPTION OF DQ OUTPUTS
    %% ======================================================

    subgraph Silver["Silver Cleaned Inputs"]
        S1["sales_clean"]
        S2["products_clean"]
        S3["customers_clean"]
    end

    subgraph DQ["DQ Processing"]
        DQ1["Row-Level Validation"]
        DQ2["Routing Logic<br/>PASS / FAIL"]
        DQ3["DQ Summary Aggregation"]
    end

    subgraph Outputs["DQ Outputs"]
        O1["Clean Output Tables<br/>dq_pass_*"]
        O2["Exception Tables<br/>dq_*_exceptions"]
        O3["DQ Summary Table"]
    end

    subgraph Gold["Gold Layer"]
        G1["fact_sales<br/>Consumes only PASS rows"]
        G2["dim_product<br/>Consumes only PASS rows"]
        G3["dim_customer<br/>Consumes only PASS rows"]
    end

    subgraph Monitoring["Monitoring & Observability"]
        M1["DQ Dashboard<br/>Pass/Fail Trends"]
        M2["Exception Volume Alerts"]
        M3["Rule-Level Quality KPIs"]
    end

    %% FLOW: SILVER → DQ
    S1 --> DQ1
    S2 --> DQ1
    S3 --> DQ1

    %% DQ ENGINE
    DQ1 --> DQ2
    DQ1 --> DQ3

    %% ROUTING
    DQ2 --> O1
    DQ2 --> O2
    DQ3 --> O3

    %% GOLD CONSUMPTION
    O1 --> G1
    O1 --> G2
    O1 --> G3

    %% MONITORING
    O2 --> M1
    O2 --> M2
    O3 --> M1
    O3 --> M3