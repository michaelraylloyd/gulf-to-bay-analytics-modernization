flowchart TD

    %% ======================================================
    %%   FABRIC SALES ANALYTICS â€” DQ INTEGRATION ACROSS SDLC
    %% ======================================================

    %% -------- DEVELOPMENT --------
    subgraph Dev["Development"]
        D1["Author Rules<br/>expectations.json"]
        D2["Local Testing<br/>Sample data validation"]
        D3["Notebook-Level DQ Tests<br/>Unit checks"]
        D4["Commit to Repo<br/>Version control"]
    end

    %% -------- CI/CD --------
    subgraph CICD["CI/CD Pipeline"]
        C1["Lint & Validate Rules"]
        C2["Schema Drift Detection"]
        C3["Automated DQ Unit Tests"]
        C4["Build Artifact<br/>expectations.json bundle"]
        C5["Promote to Dev Workspace"]
    end

    %% -------- QA / TEST --------
    subgraph QA["QA / Test Environment"]
        Q1["Run Full DQ Suite<br/>Against test datasets"]
        Q2["Compare Against Baselines"]
        Q3["Detect False Positives"]
        Q4["Approve for Production"]
    end

    %% -------- PRODUCTION --------
    subgraph Prod["Production"]
        P1["Pipeline Execution<br/>DQ validation at scale"]
        P2["Exception Tables<br/>dq_*_exceptions"]
        P3["DQ Summary Table"]
        P4["SLA Enforcement"]
    end

    %% -------- OBSERVABILITY --------
    subgraph Obs["Observability"]
        O1["DQ Dashboard"]
        O2["Exception Trends"]
        O3["Pipeline Health"]
        O4["Alerts<br/>Spikes, SLA breaches"]
    end

    %% -------- FEEDBACK LOOP --------
    subgraph Feedback["Continuous Improvement"]
        F1["Refine Rules"]
        F2["Adjust Thresholds"]
        F3["Update Metadata"]
        F4["Retire Obsolete Rules"]
    end

    %% FLOWS
    D1 --> D2 --> D3 --> D4 --> C1
    C1 --> C2 --> C3 --> C4 --> C5 --> Q1
    Q1 --> Q2 --> Q3 --> Q4 --> P1

    P1 --> P2
    P1 --> P3
    P3 --> P4

    P2 --> O1
    P3 --> O2
    P4 --> O3
    O3 --> O4

    O1 --> F1
    O2 --> F2
    O3 --> F3
    O4 --> F4

    F1 --> D1
    F2 --> D1
    F3 --> D1
    F4 --> D1